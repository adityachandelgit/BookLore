<form [formGroup]="metadataForm" (ngSubmit)="onSave()" *ngIf="bookMetadata$ | async as metadata" class="h-full flex pt-1 flex-col">
  <div class="overflow-y-scroll flex-1">
    <div class="flex justify-center items-center" [ngStyle]="{'padding-bottom': '0.75rem', 'padding-left': '7.6rem'}">
      <p class="ml-3 text-lg">Current Metadata</p>
      <p-button
        severity="info"
        icon='pi pi-angle-left'
        [ngStyle]="{'padding-left': '2rem', 'padding-right': '0.5rem'}"
        [outlined]="true"
        pTooltip="Move all missing fields" tooltipPosition="bottom"
        (onClick)="copyMissing()"></p-button>
      <p-button
        severity="info"
        icon='pi pi-angle-double-left'
        [ngStyle]="{'padding-left': '0.5rem', 'padding-right': '2rem'}"
        [outlined]="true"
        pTooltip="Move all fields" tooltipPosition="bottom"
        (onClick)="copyAll()"></p-button>
      <p class="text-lg">Fetched Metadata</p>
    </div>

    <div class="form-row">
      <label class="label"></label>
      <div class="input-container">
        <p-button *ngIf="!metadata['coverLocked']" icon="pi pi-lock-open" [outlined]="true" (onClick)="toggleLock('thumbnailUrl')" severity="success"></p-button>
        <p-button *ngIf="metadata['coverLocked']" icon="pi pi-lock" [outlined]="true" (onClick)="toggleLock('thumbnailUrl')" severity="warn"></p-button>
        <img [src]="metadataForm.get('thumbnailUrl')?.value" alt="Book Thumbnail" class="thumbnail"/>
        <input type="hidden" id="thumbnailUrl" formControlName="thumbnailUrl" class="input"/>
        <p-button
          [icon]="isValueSaved('thumbnailUrl') ? 'pi pi-check' : 'pi pi-arrow-left'"
          [outlined]="true"
          [ngClass]="{'green-outlined-button': isValueSaved('thumbnailUrl'), 'yellow-outlined-button': isValueCopied('thumbnailUrl')}"
          class="arrow-button"
          (click)="copyFetchedToCurrent('thumbnailUrl')"/>
        <input type="hidden" [value]="fetchedMetadata.thumbnailUrl" class="input" readonly/>
        <img [src]="fetchedMetadata.thumbnailUrl ?? null" alt="Fetched Thumbnail" class="thumbnail"/>
      </div>
    </div>

    <div *ngFor="let field of metadataFieldsTop" class="form-row">
      <label for="{{field.controlName}}" class="label">{{ field.label }}</label>
      <div class="input-container">
        <p-button *ngIf="!metadata[field.lockedKey]" icon="pi pi-lock-open" [outlined]="true" (onClick)="toggleLock(field.controlName)" severity="success"></p-button>
        <p-button *ngIf="metadata[field.lockedKey]" icon="pi pi-lock" [outlined]="true" (onClick)="toggleLock(field.controlName)" severity="warn"></p-button>
        <input pInputText id="{{field.controlName}}" formControlName="{{field.controlName}}" class="input"/>
        <p-button
          [icon]="isValueSaved(field.controlName) ? 'pi pi-check' : 'pi pi-arrow-left'"
          [outlined]="true"
          [ngClass]="{'green-outlined-button': isValueSaved(field.controlName), 'yellow-outlined-button': isValueCopied(field.controlName)}"
          class="arrow-button"
          (click)="copyFetchedToCurrent(field.controlName)"/>
        <input pInputText [value]="fetchedMetadata[field.fetchedKey] ?? null" class="input" readonly/>
      </div>
    </div>

    <div *ngFor="let field of metadataDescription" class="form-row">
      <label for="{{field.controlName}}" class="label">{{ field.label }}</label>
      <div class="input-container">
        <p-button *ngIf="!metadata[field.lockedKey]" icon="pi pi-lock-open" [outlined]="true" (onClick)="toggleLock(field.controlName)" severity="success"></p-button>
        <p-button *ngIf="metadata[field.lockedKey]" icon="pi pi-lock" [outlined]="true" (onClick)="toggleLock(field.controlName)" severity="warn"></p-button>
        <textarea rows="6" pTextarea id="{{field.controlName}}" formControlName="{{field.controlName}}" class="input"></textarea>
        <p-button
          [icon]="isValueSaved(field.controlName) ? 'pi pi-check' : 'pi pi-arrow-left'"
          [outlined]="true"
          [ngClass]="{'green-outlined-button': isValueSaved(field.controlName), 'yellow-outlined-button': isValueCopied(field.controlName)}"
          class="arrow-button"
          (click)="copyFetchedToCurrent(field.controlName)"/>
        <textarea rows="6" pInputText [value]="fetchedMetadata[field.fetchedKey] ?? null" class="input" readonly></textarea>
      </div>
    </div>

    <div *ngFor="let field of metadataFieldsBottom" class="form-row">
      <label for="{{field.controlName}}" class="label">{{ field.label }}</label>
      <div class="input-container">
        <p-button *ngIf="!metadata[field.lockedKey]" icon="pi pi-lock-open" [outlined]="true" (onClick)="toggleLock(field.controlName)" severity="success"></p-button>
        <p-button *ngIf="metadata[field.lockedKey]" icon="pi pi-lock" [outlined]="true" (onClick)="toggleLock(field.controlName)" severity="warn"></p-button>
        <input pInputText id="{{field.controlName}}" formControlName="{{field.controlName}}" class="input"/>
        <p-button
          [icon]="isValueSaved(field.controlName) ? 'pi pi-check' : 'pi pi-arrow-left'"
          [outlined]="true"
          [ngClass]="{'green-outlined-button': isValueSaved(field.controlName), 'yellow-outlined-button': isValueCopied(field.controlName)}"
          class="arrow-button"
          (click)="copyFetchedToCurrent(field.controlName)"/>
        <input pInputText [value]="fetchedMetadata[field.fetchedKey] ?? null" class="input" readonly/>
      </div>
    </div>

    <div class="flex justify-center items-center" [ngStyle]="{'padding-bottom': '0.75rem', 'padding-left': '7.6rem'}">
      <p class="ml-3 text-lg">Current Metadata</p>
      <p-button
        severity="info"
        icon='pi pi-angle-left'
        [ngStyle]="{'padding-left': '2rem', 'padding-right': '0.5rem'}"
        [outlined]="true"
        pTooltip="Move all missing fields" tooltipPosition="bottom"
        (onClick)="copyMissing()"></p-button>
      <p-button
        severity="info"
        icon='pi pi-angle-double-left'
        [ngStyle]="{'padding-left': '0.5rem', 'padding-right': '2rem'}"
        [outlined]="true"
        pTooltip="Move all fields" tooltipPosition="bottom"
        (onClick)="copyAll()"></p-button>
      <p class="text-lg">Fetched Metadata</p>
    </div>
  </div>

  <div class="flex flex-col gap-x-4 mt-auto">
    <p-divider></p-divider>
    <div class="flex justify-between">
      <p-button label="To Metadata List" icon="pi pi-arrow-left" severity="info" (onClick)="goBackClick()"></p-button>
      <div class="flex gap-x-4 justify-end">
        <p-button label="Unlock All" icon="pi pi-lock-open" [outlined]="true" severity="success" (onClick)="unlockAll()"></p-button>
        <p-button label="Lock All" icon="pi pi-lock" [outlined]="true" severity="warn" (onClick)="lockAll()"></p-button>
        <p-divider layout="vertical"/>
        <p-button label="Close" icon="pi pi-times" severity="secondary" (onClick)="closeDialog()"></p-button>
        <p-button label="Save" icon="pi pi-check" type="submit"></p-button>
      </div>
    </div>
  </div>
</form>
